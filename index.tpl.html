<!DOCTYPE HTML>
<html>
<head>
	
	     <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
		<title>ZenSpace Login</title>
		
</head>

<link href="resources/generic.css" rel="stylesheet" type="text/css"/>
<script src="resources/jquery.min.js" ></script>
<body>
   <div align="center" style="width:screen.width;height:screen.height;">
   <div id="generic_picture" >
			<img src="resources/zenspace.jpg" width="screen.width"/>
	</div>
	<div id="about">
	   <label style="margin-left:10px;font-size:0.6em;color:grey">On-demand Meeting space</label><br/>
	   <label style="margin-left:15px;font-size:0.6em;color:grey">Anytime.Anyplace     </label>
	</div>
	<form method="POST" id="loginform" onsubmit="return test();">
	<table>
	 <tr>
	   <td>
	     <label>KEY</label>
		</td>
		<td>
		</td>


	  <td>	
	     <input type="password"  placeholder="Enter KEY" title="Enter alphanumeric key" id="rpin" name="name" pattern="[A-Za-z0-9]{4}" maxlength="4" required="required"/>      
	  </td>
     </tr> 	  
	</table>
	<table id="adminpin">
	  <tr>
	   <td>
	     <label>PIN</label>
		</td>
		<td>
		</td>

	  <td>	
	     <input type="password"  placeholder="Enter PIN" title="Enter 4 digit PIN" id="apin" name="name" pattern="[A-Za-z0-9]{4}" maxlength="4" />      
	  </td>
	  

     </tr> 	  
	 <tr>
	 
	 
		<td>
	    <label>Duration</label>
		</td>
		<td>
		</td>

		<td>
	    <select id="duration">
		<option selected="selected" value="Select duration">Select duration</option>
		<option value="15">15</option>
		<option value="30">30</option>
		<option value="45">40</option>
		<option value="60">60</option>
		</select>
	  </td>
	  <td>
	  </td>
	 </tr>
	</table>
	<div style="color:black">
     <p> Zenspace terms and conditions</p>
   </div>
	<div  align="center" >
  	   <button type="submit" id="ag" name="agree" >I Agree to terms</button>
	   
	   
	</div>  
	<div style="margin-top:10px">
	
	   <label class="error" id="rpin_error">Enter alphanumeric key.</label>
	   <label class="error" id="rpin_ex_error"></label>
	   <label class="error" id="apin_error">Enter 4 digit number.</label>
	   <label class="error" id="apin_ex_error"></label>
    </div>	
	
   </form>
   </div>
</body>
<script>
	var adminPin = document.getElementById("adminpin").getElementsByTagName('*');
       for(var i = 0; i < adminPin.length; i++){
           adminPin[i].disabled = true;
       }
       
       $('#adminpin').children().
       css({ 'opacity' : 0 }).
       end().
       css({ 'opacity' : 0 });
       
 


     document.getElementById("rpin").onchange = function (evt) {

                            if (evt.target.checkValidity()) {
                                // OK
                                document.getElementById("rpin_error").style.display = "none";
								
                            } else {
                                // NOT OK
                                document.getElementById("rpin_error").style.display = "inline-block";
                            }
                        };
                        document.getElementById("rpin").oninput = function (evt){
							document.getElementById("ag").disabled=true;
						document.getElementById("rpin_ex_error").style.display = "none";
                            if (evt.target.checkValidity()) {
                                // OK
                                document.getElementById("rpin_error").style.display = "none";
								validate();
                            }
							else {
                                // NOT OK
                                document.getElementById("rpin_error").style.display = "inline-block";
                            }
                        };
						
	document.getElementById("apin").onchange = function (evt) {

                            if (evt.target.checkValidity()) {
                                // OK
                                document.getElementById("rpin_error").style.display = "none";
								
                            } else {
                                // NOT OK
                                document.getElementById("rpin_error").style.display = "inline-block";
                            }
                        };
                        document.getElementById("apin").oninput = function (evt){
							
						document.getElementById("rpin_ex_error").style.display = "none";
                            if (evt.target.checkValidity()) {
                                // OK
                                document.getElementById("rpin_error").style.display = "none";

                            }
							else {
                                // NOT OK
                                document.getElementById("rpin_error").style.display = "inline-block";
                            }
                        };
	document.getElementById("duration").onchange = function (evt) {


                            if (evt.target.checkValidity()) {
                                // OK
                                document.getElementById("rpin_error").style.display = "none";
								validate_admin();
                            } else {
                                // NOT OK
                                document.getElementById("rpin_error").style.display = "inline-block";
                            }
                        };
                        
					

function test()
{
 
  var s=document.getElementById("ag").disabled;
    
  if(s == "false")
  {
    document.getElementById("ag").value="Fail";
    return false;
  }
  else
  {
    document.getElementById("rpin_ex_error").innerHTML="Validated..";
	document.getElementById("rpin_ex_error").innerHTML="Start browsing now..";
	document.getElementById("ag").value="Success";
    		
    return true;
  }
  
} 



function validate ()
 {
	document.getElementById("rpin_ex_error").innerHTML="validating...";
	document.getElementById("rpin_ex_error").style.display="inline-block";
    var pin=document.getElementById("rpin").value;
	
	var http = new XMLHttpRequest();
	
	
	var getUrl='http://192.168.100.1:9002/'
	var url=getUrl+'doorLock'
	
	var params = '{"pin":"'+pin+'"}'

	http.open('POST', url,true);
	/*if(http.status == 200 )
	{
	   document.getElementById("rpin_ex_error").innerHTML="validating in progress.";
	}
	else
	{
	   document.getElementById("rpin_ex_error").style.color="red"
	   document.getElementById("rpin_ex_error").innerHTML="Server unreachable. Try again.";
	}
  */
	//Send the proper header information along with the request
	
	http.setRequestHeader("Content-Type", "application/json");
    
	http.onreadystatechange = function() {
	
	//Call a function when the state changes.
	  	 
		if(http.readyState == 4 && http.status == 200 || http.status == 401 || http.status == 202) {
	       
			
			var s=JSON.parse(http.responseText);
			
		    if( s.success == "false" || s.success == "timeout" )
			{
			   document.getElementById("rpin_ex_error").style.color="red"
			   document.getElementById("rpin_ex_error").innerHTML="Incorrect PIN. Try again.";
			   document.getElementById("rpin_ex_error").style.display = "inline-block";
			   document.getElementById("ag").disabled=true;
			}
			else if(s.success == "true" )
			{
			   document.getElementById("rpin_ex_error").style.color="#0D47A1";
			   document.getElementById("rpin_ex_error").innerHTML="Click agree to continue.";
			   document.getElementById("ag").disabled=false;
			   
			  
			}
			else if(s.success == "ok" )
			{
				document.getElementById("rpin_ex_error").style.color="#0D47A1";
				var adminPin = document.getElementById("adminpin").getElementsByTagName('*');
				   for(var i = 0; i < adminPin.length; i++){
					   adminPin[i].disabled = false;
				   }
				   
				   $('#adminpin').children().
				   css({ 'opacity' : 100 }).
				   end().
				   css({ 'opacity' : 100 });
						
						}
						
		  	 
		}
		
		else{
		   //alert(http.responseText);
		}
	   
	
	}
	 http.send(params);
	 
	
	
	
	

 }
 
function validate_admin()
{
	document.getElementById("rpin_ex_error").innerHTML="validating...";
	document.getElementById("rpin_ex_error").style.display="inline-block";
    var key=document.getElementById("rpin").value;
	var pin=document.getElementById("apin").value;
	var duration=document.getElementById("duration").value;

	
	var http = new XMLHttpRequest();
	
	
	var getUrl='http://192.168.100.1:9002/'
	var url=getUrl+'admindoorLock'
	
	var params = '{"adminkey":"'+key+'","adminpin":"'+pin+'","duration":"'+duration+'"}'
	//alert(params)
	http.open('POST', url,true);
	/*if(http.status == 200 )
	{
	   document.getElementById("rpin_ex_error").innerHTML="validating in progress.";
	}
	else
	{
	   document.getElementById("rpin_ex_error").style.color="red"
	   document.getElementById("rpin_ex_error").innerHTML="Server unreachable. Try again.";
	}
  */
	//Send the proper header information along with the request
	
	http.setRequestHeader("Content-Type", "application/json");
    
	http.onreadystatechange = function() {
	
	//Call a function when the state changes.
	  	 
		if(http.readyState == 4 && http.status == 200 || http.status == 401 ) {
	       
			
			var s=JSON.parse(http.responseText);
			
		    if( s.success == "false" || s.success == "timeout" )
			{
			   document.getElementById("rpin_ex_error").style.color="red"
			   document.getElementById("rpin_ex_error").innerHTML="Incorrect PIN. Try again.";
			   document.getElementById("rpin_ex_error").style.display = "inline-block";
			   document.getElementById("ag").disabled=true;
			}
			else if(s.success == "true" )
			{
			   document.getElementById("rpin_ex_error").style.color="#0D47A1";
			   document.getElementById("rpin_ex_error").innerHTML="Click agree to continue.";
			   document.getElementById("ag").disabled=false;
			   
			  
			}
			 
		}
		
		else{
		   //alert(http.responseText);
		}
	   
	
	}
	 http.send(params);
	 
	
	
	

}  
 
</script>
   